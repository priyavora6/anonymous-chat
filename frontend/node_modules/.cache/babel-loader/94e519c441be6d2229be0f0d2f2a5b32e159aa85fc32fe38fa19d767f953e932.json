{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import'./styles.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Chat(_ref){let{deviceId,profile}=_ref;const[ws,setWs]=useState(null);const[state,setState]=useState('idle');// idle, queued, matched, chatting\nconst[peer,setPeer]=useState(null);const[messages,setMessages]=useState([]);const msgRef=useRef();useEffect(()=>{const socket=new WebSocket(\"ws://localhost:8000/ws?device_id=\".concat(deviceId));socket.onopen=()=>{setWs(socket);};socket.onmessage=e=>{const d=JSON.parse(e.data);if(d.type==='queued')setState('queued');if(d.type==='matched'){setPeer(d.peer);setState('chatting');}if(d.type==='msg'){setMessages(m=>[...m,{from:d.from,text:d.text}]);}if(d.type==='peer_left'){setState('idle');setPeer(null);}};socket.onclose=()=>setWs(null);return()=>socket.close();},[deviceId]);function joinQueue(filter){if(!ws)return;ws.send(JSON.stringify({action:'join',filter,nickname:profile.nickname}));}function leave(){if(!ws)return;ws.send(JSON.stringify({action:'leave'}));setState('idle');setPeer(null);}function sendMsg(){const text=msgRef.current.value;if(!text||!ws)return;ws.send(JSON.stringify({action:'msg',text}));setMessages(m=>[...m,{from:'me',text}]);msgRef.current.value='';}function nextMatch(){if(!ws)return;ws.send(JSON.stringify({action:'next'}));// re-join default any\nws.send(JSON.stringify({action:'join',filter:'any',nickname:profile.nickname}));}function report(){if(!ws||!peer)return;ws.send(JSON.stringify({action:'report',reported:peer}));alert('Reported — thank you');}return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-root\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Nickname\"}),\": \",profile.nickname]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Bio\"}),\": \",profile.bio]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Gender\"}),\": \",profile.gender]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>joinQueue('any'),children:\"Join Any\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>joinQueue('male'),children:\"Join Male\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>joinQueue('female'),children:\"Join Female\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:12},children:/*#__PURE__*/_jsx(\"button\",{onClick:leave,children:\"Leave\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-area\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",children:[\"State: \",state,\" \",peer?\"(peer \".concat(peer,\")\"):'']}),/*#__PURE__*/_jsx(\"div\",{className:\"messages\",children:messages.map((m,i)=>/*#__PURE__*/_jsxs(\"div\",{className:\"msg \".concat(m.from==='me'?'me':'them'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"msg-from\",children:m.from==='me'?profile.nickname:'Stranger'}),/*#__PURE__*/_jsx(\"div\",{className:\"msg-text\",children:m.text})]},i))}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-controls\",children:[/*#__PURE__*/_jsx(\"input\",{ref:msgRef,placeholder:\"Type a message\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMsg,children:\"Send\"}),/*#__PURE__*/_jsx(\"button\",{onClick:nextMatch,children:\"Next\"}),/*#__PURE__*/_jsx(\"button\",{onClick:report,children:\"Report\"})]})]})]});}","map":{"version":3,"names":["React","useEffect","useRef","useState","jsx","_jsx","jsxs","_jsxs","Chat","_ref","deviceId","profile","ws","setWs","state","setState","peer","setPeer","messages","setMessages","msgRef","socket","WebSocket","concat","onopen","onmessage","e","d","JSON","parse","data","type","m","from","text","onclose","close","joinQueue","filter","send","stringify","action","nickname","leave","sendMsg","current","value","nextMatch","report","reported","alert","className","children","bio","gender","style","marginTop","onClick","map","i","ref","placeholder"],"sources":["D:/sem 6/anonymous-chat/frontend/src/Chat.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\r\nimport './styles.css'\r\n\r\nexport default function Chat({ deviceId, profile }) {\r\n  const [ws, setWs] = useState(null)\r\n  const [state, setState] = useState('idle') // idle, queued, matched, chatting\r\n  const [peer, setPeer] = useState(null)\r\n  const [messages, setMessages] = useState([])\r\n  const msgRef = useRef()\r\n\r\n  useEffect(() => {\r\n    const socket = new WebSocket(`ws://localhost:8000/ws?device_id=${deviceId}`)\r\n    socket.onopen = () => {\r\n      setWs(socket)\r\n    }\r\n    socket.onmessage = (e) => {\r\n      const d = JSON.parse(e.data)\r\n      if (d.type === 'queued') setState('queued')\r\n      if (d.type === 'matched') {\r\n        setPeer(d.peer)\r\n        setState('chatting')\r\n      }\r\n      if (d.type === 'msg') {\r\n        setMessages((m) => [...m, { from: d.from, text: d.text }])\r\n      }\r\n      if (d.type === 'peer_left') {\r\n        setState('idle')\r\n        setPeer(null)\r\n      }\r\n    }\r\n    socket.onclose = () => setWs(null)\r\n    return () => socket.close()\r\n  }, [deviceId])\r\n\r\n  function joinQueue(filter) {\r\n    if (!ws) return\r\n    ws.send(JSON.stringify({ action: 'join', filter, nickname: profile.nickname }))\r\n  }\r\n\r\n  function leave() {\r\n    if (!ws) return\r\n    ws.send(JSON.stringify({ action: 'leave' }))\r\n    setState('idle')\r\n    setPeer(null)\r\n  }\r\n\r\n  function sendMsg() {\r\n    const text = msgRef.current.value\r\n    if (!text || !ws) return\r\n    ws.send(JSON.stringify({ action: 'msg', text }))\r\n    setMessages((m) => [...m, { from: 'me', text }])\r\n    msgRef.current.value = ''\r\n  }\r\n\r\n  function nextMatch() {\r\n    if (!ws) return\r\n    ws.send(JSON.stringify({ action: 'next' }))\r\n    // re-join default any\r\n    ws.send(JSON.stringify({ action: 'join', filter: 'any', nickname: profile.nickname }))\r\n  }\r\n\r\n  function report() {\r\n    if (!ws || !peer) return\r\n    ws.send(JSON.stringify({ action: 'report', reported: peer }))\r\n    alert('Reported — thank you')\r\n  }\r\n\r\n  return (\r\n    <div className=\"chat-root\">\r\n      <div className=\"sidebar\">\r\n        <div><strong>Nickname</strong>: {profile.nickname}</div>\r\n        <div><strong>Bio</strong>: {profile.bio}</div>\r\n        <div><strong>Gender</strong>: {profile.gender}</div>\r\n        <div style={{ marginTop: 12 }}>\r\n          <button onClick={() => joinQueue('any')}>Join Any</button>\r\n          <button onClick={() => joinQueue('male')}>Join Male</button>\r\n          <button onClick={() => joinQueue('female')}>Join Female</button>\r\n        </div>\r\n        <div style={{ marginTop: 12 }}>\r\n          <button onClick={leave}>Leave</button>\r\n        </div>\r\n      </div>\r\n      <div className=\"chat-area\">\r\n        <div className=\"chat-header\">State: {state} {peer ? `(peer ${peer})` : ''}</div>\r\n        <div className=\"messages\">\r\n          {messages.map((m, i) => (\r\n            <div key={i} className={`msg ${m.from === 'me' ? 'me' : 'them'}`}>\r\n              <div className=\"msg-from\">{m.from === 'me' ? profile.nickname : 'Stranger'}</div>\r\n              <div className=\"msg-text\">{m.text}</div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div className=\"chat-controls\">\r\n          <input ref={msgRef} placeholder=\"Type a message\" />\r\n          <button onClick={sendMsg}>Send</button>\r\n          <button onClick={nextMatch}>Next</button>\r\n          <button onClick={report}>Report</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}