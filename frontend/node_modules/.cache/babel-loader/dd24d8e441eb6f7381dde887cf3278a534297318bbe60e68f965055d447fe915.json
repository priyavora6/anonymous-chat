{"ast":null,"code":"import React,{useRef,useEffect,useState}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function CameraCapture(_ref){let{deviceId,onVerified}=_ref;const videoRef=useRef(null);const canvasRef=useRef(null);const[status,setStatus]=useState('idle');useEffect(()=>{let mounted=true;async function start(){try{const s=await navigator.mediaDevices.getUserMedia({video:true});if(!mounted)return;if(videoRef.current)videoRef.current.srcObject=s;}catch(e){setStatus('error');}}start();return()=>{mounted=false;const s=videoRef.current&&videoRef.current.srcObject;if(s)s.getTracks().forEach(t=>t.stop());};},[]);function capture(){setStatus('capturing');const v=videoRef.current;const c=canvasRef.current;if(!v||!c)return;c.width=v.videoWidth||640;c.height=v.videoHeight||480;const ctx=c.getContext('2d');ctx.drawImage(v,0,0,c.width,c.height);c.toBlob(async blob=>{if(!blob){setStatus('error');return;}setStatus('uploading');try{const fd=new FormData();fd.append('file',blob,'selfie.jpg');const resp=await fetch(\"http://localhost:8000/verify?device_id=\".concat(encodeURIComponent(deviceId)),{method:'POST',body:fd});const data=await resp.json();setStatus('verified');const nickname=localStorage.getItem('anon_nickname')||'';const bio=localStorage.getItem('anon_bio')||'';onVerified&&onVerified({gender:data.gender,nickname,bio});}catch(e){console.error(e);setStatus('error');}},'image/jpeg');}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{width:360,height:270,background:'#000',borderRadius:8,overflow:'hidden'},children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,muted:true,playsInline:true,style:{width:'100%',height:'100%',objectFit:'cover'}})}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8},children:/*#__PURE__*/_jsx(\"button\",{onClick:capture,children:\"Capture (gallery disabled)\"})}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,style:{display:'none'}}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Status: \",status]})]});}","map":{"version":3,"names":["React","useRef","useEffect","useState","jsx","_jsx","jsxs","_jsxs","CameraCapture","_ref","deviceId","onVerified","videoRef","canvasRef","status","setStatus","mounted","start","s","navigator","mediaDevices","getUserMedia","video","current","srcObject","e","getTracks","forEach","t","stop","capture","v","c","width","videoWidth","height","videoHeight","ctx","getContext","drawImage","toBlob","blob","fd","FormData","append","resp","fetch","concat","encodeURIComponent","method","body","data","json","nickname","localStorage","getItem","bio","gender","console","error","children","style","background","borderRadius","overflow","ref","autoPlay","muted","playsInline","objectFit","marginTop","onClick","display"],"sources":["D:/sem 6/anonymous-chat/frontend/src/components/CameraCapture.jsx"],"sourcesContent":["import React, {useRef, useEffect, useState} from 'react'\r\n\r\nexport default function CameraCapture({ deviceId, onVerified }){\r\n  const videoRef = useRef(null)\r\n  const canvasRef = useRef(null)\r\n  const [status,setStatus] = useState('idle')\r\n\r\n  useEffect(()=>{\r\n    let mounted = true\r\n    async function start(){\r\n      try{\r\n        const s = await navigator.mediaDevices.getUserMedia({video:true})\r\n        if(!mounted) return\r\n        if(videoRef.current) videoRef.current.srcObject = s\r\n      }catch(e){\r\n        setStatus('error')\r\n      }\r\n    }\r\n    start()\r\n    return ()=>{\r\n      mounted = false\r\n      const s = videoRef.current && videoRef.current.srcObject\r\n      if(s) s.getTracks().forEach(t=>t.stop())\r\n    }\r\n  },[])\r\n\r\n  function capture(){\r\n    setStatus('capturing')\r\n    const v = videoRef.current\r\n    const c = canvasRef.current\r\n    if(!v||!c) return\r\n    c.width = v.videoWidth || 640\r\n    c.height = v.videoHeight || 480\r\n    const ctx = c.getContext('2d')\r\n    ctx.drawImage(v,0,0,c.width,c.height)\r\n    c.toBlob(async (blob)=>{\r\n      if (!blob) { setStatus('error'); return }\r\n      setStatus('uploading')\r\n      try {\r\n        const fd = new FormData()\r\n        fd.append('file', blob, 'selfie.jpg')\r\n        const resp = await fetch(`http://localhost:8000/verify?device_id=${encodeURIComponent(deviceId)}`, {\r\n          method: 'POST',\r\n          body: fd,\r\n        })\r\n        const data = await resp.json()\r\n        setStatus('verified')\r\n        const nickname = localStorage.getItem('anon_nickname') || ''\r\n        const bio = localStorage.getItem('anon_bio') || ''\r\n        onVerified && onVerified({ gender: data.gender, nickname, bio })\r\n      } catch (e) {\r\n        console.error(e)\r\n        setStatus('error')\r\n      }\r\n    },'image/jpeg')\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div style={{width:360,height:270,background:'#000',borderRadius:8,overflow:'hidden'}}>\r\n        <video ref={videoRef} autoPlay muted playsInline style={{width:'100%',height:'100%',objectFit:'cover'}} />\r\n      </div>\r\n      <div style={{marginTop:8}}>\r\n        <button onClick={capture}>Capture (gallery disabled)</button>\r\n      </div>\r\n      <canvas ref={canvasRef} style={{display:'none'}} />\r\n      <div>Status: {status}</div>\r\n    </div>\r\n  )\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}